---
- name: Ensure github ssh access is configured
  hosts: all
  vars:
    ssh_key: ~/.ssh/keys/github_id_rsa
    # ssh_key: ~/.ssh/id_rsa
  tasks:

    - name: Ensure github ssh key is present
      ansible.builtin.copy:
        src: "{{ ssh_key }}"
        dest: ~/.ssh/github_id_rsa
        mode: 0600

    - name: Ensure github ssh config entry exists
      ansible.builtin.blockinfile:
        path: ~/.ssh/config
        marker: "# {mark}: Ansible managed github config"
        block: |
          Host github.com
            HostName github.com
            IdentityFile ~/.ssh/github_id_rsa
        create: true
        mode: 0644

    - name: Ensure .gitconfig file is populated
      ansible.builtin.blockinfile:
        path: ~/.gitconfig
        marker: "# {mark}: Ansible managed config"
        block: |
          [core]
          editor = vim
          [user]
          name = Scott Davidson
          email = scott@stackhpc.com
          [editor]
        create: true
        mode: 0644


    - name: Ensure gitup tool is installed
      become: true
      ansible.builtin.package:
        name:
          - python3-git-repo-updater # Apt packaging of gitup tool
        state: present
      when: ansible_distribution == 'Ubuntu'